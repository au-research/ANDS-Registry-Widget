/*
 *  ANDS-Registry-Widget - v0.0.1
 *  A Widget to display and search for ANDS Registry contents
 *  https://developers.ands.org.au/
 *
 *  Made by Minh Duc Nguyen
 *  Under MIT License
 */
!function(a,b,c,d){"use strict";function e(b,c){this.element=b,this.settings=a.extend({},h,c),this._defaults=h,this.params=i,this._name=g,this.init()}function f(b){return{lookup:function(a){return this.get(b.api_url,a).then(function(a){return a})},get:function(b,c){return a.ajax({dataType:"jsonp",url:b,data:c}).then(function(a){return a})}}}var g="registryWidget",h={mode:"lookup-grant",type:"grant",api_url:"",service_url:"http://devl.ands.org.au/minh/api/"},i={api_key:"public"};a.extend(e.prototype,{init:function(){this.setParams(),this.service=new f(this.settings);var b=a(this.element),c=this;switch(this.settings.mode){case"lookup-grant":this.service.lookup(this.params).done(function(d){c.hasCallback("lookup")?c.callback("lookup",b,d):a(b).text(JSON.stringify(d.recordData))})}},hasCallback:function(a){return!(!this.settings.hasOwnProperty("evt")||!this.settings.evt.hasOwnProperty(a)||"function"!=typeof this.settings.evt[a])},callback:function(a,b,c){this.settings.evt[a](b,c)},setParams:function(){"grant"==this.settings.type&&(this.settings.api_url=this.settings.service_url+"v2.0/registry.jsonp/grants"),this.settings.api_key&&(this.params.api_key=this.settings.api_key),this.params=a.extend({},this.params,a(this.element).data())},bindLookup:function(b){a(b).blur(this.lookup)},setValue:function(b){a(this.element).val(b)},setText:function(b){a(this.element).text(b)}}),a.fn[g]=function(b){return this.each(function(){a.data(this,"plugin_"+g)||a.data(this,"plugin_"+g,new e(this,b))})}}(jQuery,window,document);